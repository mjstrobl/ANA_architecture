<!DOCTYPE html>
<html>
<head>
    <title>Automated Nursing Agent</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/kgp.css">
</head>
    <body>
    <div id="topdiv">
        <div id="chat">
            <ul id="messages"></ul>

        </div>
        <div id="tabs">

            <!-- Tab links -->
            <div class="tab">
                <button class="tablinks active" onclick="openService(event, 'KGP')">KGP</button>
                <button class="tablinks" onclick="openService(event, 'Emotions')">Emotions</button>
                <button class="tablinks" onclick="openService(event, 'RG')">RG</button>
                <button class="tablinks" onclick="openService(event, 'Topics')">Topics</button>
            </div>

            <!-- Tab content -->
            <div id="KGP" class="tabcontent">
                <div id="graph">

                </div>
                <div id="graph_str">

                </div>
            </div>

            <div id="Emotions" class="tabcontent">
                <div id="emotions_div">

                </div>

            </div>

            <div id="RG" class="tabcontent">
                <div id="rg_div">

                </div>
            </div>

            <div id="Topics" class="tabcontent">
                <div id="topic_div">

                </div>
            </div>
        </div>
    </div>
    <div id="bottomdiv">
            <form id="form" action="">
                <input id="input" autocomplete="off" /><button>Send</button>
            </form>
    </div>
        <script src="/socket.io/socket.io.js"></script>
        <script type='text/javascript' src="/kgp.js"></script>

        <script>
            var socket = io();

            var messages = document.getElementById('messages');
            var form = document.getElementById('form');
            var input = document.getElementById('input');

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (input.value) {
                    // emit message to server as well as this client (just for displaying).
                    socket.emit('message', input.value);
                    add_message(input.value, "userText", "#009688")
                    input.value = '';
                }
            });

            socket.on('ana_server_response', function(msg) {

                console.log("got server response")
                console.log(msg)

                if (msg.service) {
                    color = "#EF5350"
                    if (msg.service === 'kgp') {
                        console.log("draw network")
                        draw_network(msg);
                        color = "#EF5350"
                    } else if (msg.service === "emotions") {
                        console.log("display emotions")
                        color = "#1f1a15"

                        document.getElementById("emotions_div").textContent = msg.emotions
                    } else if (msg.service === "rg") {
                        console.log("got a response: " + msg.message)
                        color = "#90ef50"
                        document.getElementById("rg_div").textContent = "Got a response: " + msg.message
                    } else if (msg.service === "topic_model") {
                        console.log("got a response: " + msg.topic_model_message);
                        document.getElementById("topic_div").textContent = "Topic response: " + msg.topic_model_topics
                    }

                    if (msg.message && msg.message.length > 0) {
                        add_message(msg.message, "botText", color)
                    }
                }

            });

            function openService(evt, serviceName) {
                // Declare all variables
                var i, tabcontent, tablinks;

                // Get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }

                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }

                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(serviceName).style.display = "block";
                evt.currentTarget.className += " active";
            }

            function add_message(message, className, color) {
                var outerItem = document.createElement('p');
                outerItem.className = className;
                var innerItem = document.createElement('span');
                innerItem.style.backgroundColor = color
                innerItem.innerHTML = message;
                outerItem.appendChild(innerItem);
                messages.appendChild(outerItem);
                document.getElementById("chat").scrollTo(0, document.getElementById("chat").scrollHeight);
            }

        </script>
    </body>
</html>
